<!DOCTYPE html>
<html lang="fr">
<head>
  <script type="text/javascript" src="https://cdn.emailjs.com/dist/email.min.js"></script>
  <script>
    (function(){
      emailjs.init("zu7wreF2cdUHqhcxS"); // Ma cle public
    })();
</script>

  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" />
  <title>Proposer une prestation</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <%- include('partials/header') %>

  <h1>ü§ù Proposer une prestation</h1>
  <p style="text-align: center;">Remplis ce formulaire pour proposer tes services √† la communaut√© √©tudiante.</p>

  <main style="max-width: 600px; margin: 0 auto; padding: 2rem;">
    <form action="/proposer" method="POST" class="proposer-form">
      <label>Nom : <input type="text" name="nom" required /></label><br/><br/>
      <label>Comp√©tences : <input type="text" name="competence" required /></label><br/><br/>
      <label>Disponibilit√© : <input type="text" name="dispo" required /></label><br/><br/>
      <label>Niveau : <input type="text" name="niveau" required /></label><br/><br/>
      <label>Email : <input type="email" name="email" required /></label><br/><br/>
      <label>Titre du service : <input type="text" name="titre" required></label><br/><br/>
      <label>Contact (email ou t√©l√©phone) : <input type="text" name="contact" required></label><br/><br/>
      <label>Description :
        <textarea name="description" rows="4" required class="desc-textarea"></textarea>
      </label><br/><br/>
      <label>Cat√©gorie :
        <select name="categorie" required>
          <option value="">Choisir une cat√©gorie</option>
          <option value="cours">Cours particuliers</option>
          <option value="depannage">D√©pannage informatique</option>
          <option value="design">Design graphique</option>
          <option value="traduction">Traduction & relecture</option>
        </select>
      </label><br/><br/>
      <button type="submit" class="btn">Proposer mon service</button>
    </form>
  </main>

  <%- include('partials/footer') %>

  <% if (typeof success !== "undefined") { %>
  <div class="success"><%= success %></div>
  <% } %>
  <% if (typeof errors !== "undefined" && errors.length > 0) { %>
  <ul class="error">
    <% errors.forEach(function(error) { %>
      <li><%= error.msg %></li>
    <% }); %>
  </ul>
  <% } %>

<script>
  document.getElementById("propositionForm").addEventListener("submit", function(e) {
    e.preventDefault();

    const form = this;
    const data = Object.fromEntries(new FormData(form).entries());

    // ‚úÖ Envoie l'email via EmailJS
    emailjs.send("service_3ptka06", "template_t9hzjba", {
      nom: data.nom,
      competence: data.competence,
      dispo: data.dispo,
      niveau: data.niveau,
      email: data.email,
      categorie: data.categorie
    }).then(function(response) {
      alert("Merci ! Ta candidature a √©t√© envoy√©e √† l‚Äô√©quipe.");
      form.reset();
      window.location.href = "merci.html"; // redirection apr√®s envoi
    }, function(error) {
      alert("Erreur lors de l'envoi. R√©essaie plus tard.");
      console.log(error);
    });

    // Optionnel : sauvegarder localement pour debug
    /*
    let existants = JSON.parse(localStorage.getItem(data.categorie)) || [];
    existants.push(data);
    localStorage.setItem(data.categorie, JSON.stringify(existants));
    */
  });



  // D√©finir un "admin" simul√© (dans une vraie version ce serait via un login s√©curis√©)
const estAdmin = localStorage.getItem("admin") === "true";

if (estAdmin) {
  const navLinks = document.getElementById("navLinks");
  const adminLink = document.createElement("li");
  adminLink.innerHTML = `<a href="admin.html">Admin üîí</a>`;
  navLinks.appendChild(adminLink);
}
</script>
</body>
</html>